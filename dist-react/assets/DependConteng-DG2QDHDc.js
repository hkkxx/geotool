import{r as l,j as p}from"./client-BQcxdo_o.js";import{b as oe,H as ae,J as re,K as le,L as se,M as ie,h as G,T as ce,g as de,a as pe,A as ue,S as W,F as L,E as me,p as fe,q as F,r as ge,s as xe,t as he,v as ye,x as ve,y as Ce,z as be,B as Oe,C as Pe,D as we,I as je,l as Se,m as R,n as ke,o as Ne,G as K,j as A}from"./autocomplete-icons-B_YS--RH.js";import{u as $e,a as Ee,b as Te}from"./reduxStore-DW7bpBHV.js";import{K as _e,B as X,c as Ie,o as Be,s as $}from"./index-BKKsEUkk.js";import{h as J,m as ze,r as Me,j as E,c as T,S as We,t as U,A as Re}from"./index-BRSFQlkS.js";const k=e=>e?typeof e=="function"?e():e:null,De=e=>{const{componentCls:n,popoverColor:o,titleMinWidth:t,fontWeightStrong:a,innerPadding:i,boxShadowSecondary:f,colorTextHeading:u,borderRadiusLG:d,zIndexPopup:x,titleMarginBottom:g,colorBgElevated:h,popoverBg:v,titleBorderBottom:C,innerContentPadding:O,titlePadding:r}=e;return[{[n]:Object.assign(Object.assign({},Me(e)),{position:"absolute",top:0,left:{_skip_check_:!0,value:0},zIndex:x,fontWeight:"normal",whiteSpace:"normal",textAlign:"start",cursor:"auto",userSelect:"text","--valid-offset-x":"var(--arrow-offset-horizontal, var(--arrow-x))",transformOrigin:["var(--valid-offset-x, 50%)","var(--arrow-y, 50%)"].join(" "),"--antd-arrow-background-color":h,width:"max-content",maxWidth:"100vw","&-rtl":{direction:"rtl"},"&-hidden":{display:"none"},[`${n}-content`]:{position:"relative"},[`${n}-inner`]:{backgroundColor:v,backgroundClip:"padding-box",borderRadius:d,boxShadow:f,padding:i},[`${n}-title`]:{minWidth:t,marginBottom:g,color:u,fontWeight:a,borderBottom:C,padding:r},[`${n}-inner-content`]:{color:o,padding:O}})},ae(e,"var(--antd-arrow-background-color)"),{[`${n}-pure`]:{position:"relative",maxWidth:"none",margin:e.sizePopupArrow,display:"inline-block",[`${n}-content`]:{display:"inline-block"}}}]},Ve=e=>{const{componentCls:n}=e;return{[n]:re.map(o=>{const t=e[`${o}6`];return{[`&${n}-${o}`]:{"--antd-arrow-background-color":t,[`${n}-inner`]:{backgroundColor:t},[`${n}-arrow`]:{background:"transparent"}}}})}},He=e=>{const{lineWidth:n,controlHeight:o,fontHeight:t,padding:a,wireframe:i,zIndexPopupBase:f,borderRadiusLG:u,marginXS:d,lineType:x,colorSplit:g,paddingSM:h}=e,v=o-t,C=v/2,O=v/2-n,r=a;return Object.assign(Object.assign(Object.assign({titleMinWidth:177,zIndexPopup:f+30},le(e)),se({contentRadius:u,limitVerticalRadius:!0})),{innerPadding:i?0:12,titleMarginBottom:i?0:d,titlePadding:i?`${C}px ${r}px ${O}px`:0,titleBorderBottom:i?`${n}px ${x} ${g}`:"none",innerContentPadding:i?`${h}px ${r}px`:0})},Y=J("Popover",e=>{const{colorBgElevated:n,colorText:o}=e,t=ze(e,{popoverBg:n,popoverColor:o});return[De(t),Ve(t),oe(t,"zoom-big")]},He,{resetStyle:!1,deprecatedTokens:[["width","titleMinWidth"],["minWidth","titleMinWidth"]]});var Le=function(e,n){var o={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.indexOf(t)<0&&(o[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,t=Object.getOwnPropertySymbols(e);a<t.length;a++)n.indexOf(t[a])<0&&Object.prototype.propertyIsEnumerable.call(e,t[a])&&(o[t[a]]=e[t[a]]);return o};const q=e=>{let{title:n,content:o,prefixCls:t}=e;return!n&&!o?null:l.createElement(l.Fragment,null,n&&l.createElement("div",{className:`${t}-title`},n),o&&l.createElement("div",{className:`${t}-inner-content`},o))},Fe=e=>{const{hashId:n,prefixCls:o,className:t,style:a,placement:i="top",title:f,content:u,children:d}=e,x=k(f),g=k(u),h=T(n,o,`${o}-pure`,`${o}-placement-${i}`,t);return l.createElement("div",{className:h,style:a},l.createElement("div",{className:`${o}-arrow`}),l.createElement(ie,Object.assign({},e,{className:n,prefixCls:o}),d||l.createElement(q,{prefixCls:o,title:x,content:g})))},Z=e=>{const{prefixCls:n,className:o}=e,t=Le(e,["prefixCls","className"]),{getPrefixCls:a}=l.useContext(E),i=a("popover",n),[f,u,d]=Y(i);return f(l.createElement(Fe,Object.assign({},t,{prefixCls:i,hashId:u,className:T(o,d)})))};var Ke=function(e,n){var o={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.indexOf(t)<0&&(o[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,t=Object.getOwnPropertySymbols(e);a<t.length;a++)n.indexOf(t[a])<0&&Object.prototype.propertyIsEnumerable.call(e,t[a])&&(o[t[a]]=e[t[a]]);return o};const Ae=l.forwardRef((e,n)=>{var o,t;const{prefixCls:a,title:i,content:f,overlayClassName:u,placement:d="top",trigger:x="hover",children:g,mouseEnterDelay:h=.1,mouseLeaveDelay:v=.1,onOpenChange:C,overlayStyle:O={}}=e,r=Ke(e,["prefixCls","title","content","overlayClassName","placement","trigger","children","mouseEnterDelay","mouseLeaveDelay","onOpenChange","overlayStyle"]),{getPrefixCls:s}=l.useContext(E),c=s("popover",a),[m,w,j]=Y(c),S=s(),N=T(u,w,j),[I,B]=G(!1,{value:(o=e.open)!==null&&o!==void 0?o:e.visible,defaultValue:(t=e.defaultOpen)!==null&&t!==void 0?t:e.defaultVisible}),y=(P,_)=>{B(P,!0),C==null||C(P,_)},b=P=>{P.keyCode===_e.ESC&&y(!1,P)},z=P=>{y(P)},V=k(i),H=k(f);return m(l.createElement(ce,Object.assign({placement:d,trigger:x,mouseEnterDelay:h,mouseLeaveDelay:v,overlayStyle:O},r,{prefixCls:c,overlayClassName:N,ref:n,open:I,onOpenChange:z,overlay:V||H?l.createElement(q,{prefixCls:c,title:V,content:H}):null,transitionName:de(S,"zoom-big",r.transitionName),"data-popover-inject":!0}),We(g,{onKeyDown:P=>{var _,M;l.isValidElement(g)&&((M=g==null?void 0:(_=g.props).onKeyDown)===null||M===void 0||M.call(_,P)),b(P)}})))}),Q=Ae;Q._InternalPanelDoNotUseOrYouWillBeFired=Z;const Ge=e=>{const{componentCls:n,iconCls:o,antCls:t,zIndexPopup:a,colorText:i,colorWarning:f,marginXXS:u,marginXS:d,fontSize:x,fontWeightStrong:g,colorTextHeading:h}=e;return{[n]:{zIndex:a,[`&${t}-popover`]:{fontSize:x},[`${n}-message`]:{marginBottom:d,display:"flex",flexWrap:"nowrap",alignItems:"start",[`> ${n}-message-icon ${o}`]:{color:f,fontSize:x,lineHeight:1,marginInlineEnd:d},[`${n}-title`]:{fontWeight:g,color:h,"&:only-child":{fontWeight:"normal"}},[`${n}-description`]:{marginTop:u,color:i}},[`${n}-buttons`]:{textAlign:"end",whiteSpace:"nowrap",button:{marginInlineStart:d}}}}},Xe=e=>{const{zIndexPopupBase:n}=e;return{zIndexPopup:n+60}},ee=J("Popconfirm",e=>Ge(e),Xe,{resetStyle:!1});var Je=function(e,n){var o={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.indexOf(t)<0&&(o[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,t=Object.getOwnPropertySymbols(e);a<t.length;a++)n.indexOf(t[a])<0&&Object.prototype.propertyIsEnumerable.call(e,t[a])&&(o[t[a]]=e[t[a]]);return o};const te=e=>{const{prefixCls:n,okButtonProps:o,cancelButtonProps:t,title:a,description:i,cancelText:f,okText:u,okType:d="primary",icon:x=l.createElement(U,null),showCancel:g=!0,close:h,onConfirm:v,onCancel:C,onPopupClick:O}=e,{getPrefixCls:r}=l.useContext(E),[s]=pe("Popconfirm",Re.Popconfirm),c=k(a),m=k(i);return l.createElement("div",{className:`${n}-inner-content`,onClick:O},l.createElement("div",{className:`${n}-message`},x&&l.createElement("span",{className:`${n}-message-icon`},x),l.createElement("div",{className:`${n}-message-text`},c&&l.createElement("div",{className:`${n}-title`},c),m&&l.createElement("div",{className:`${n}-description`},m))),l.createElement("div",{className:`${n}-buttons`},g&&l.createElement(X,Object.assign({onClick:C,size:"small"},t),f||(s==null?void 0:s.cancelText)),l.createElement(ue,{buttonProps:Object.assign(Object.assign({size:"small"},Ie(d)),o),actionFn:v,close:h,prefixCls:r("btn"),quitOnNullishReturnValue:!0,emitEvent:!0},u||(s==null?void 0:s.okText))))},Ue=e=>{const{prefixCls:n,placement:o,className:t,style:a}=e,i=Je(e,["prefixCls","placement","className","style"]),{getPrefixCls:f}=l.useContext(E),u=f("popconfirm",n),[d]=ee(u);return d(l.createElement(Z,{placement:o,className:T(u,t),style:a,content:l.createElement(te,Object.assign({prefixCls:u},i))}))};var Ye=function(e,n){var o={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.indexOf(t)<0&&(o[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,t=Object.getOwnPropertySymbols(e);a<t.length;a++)n.indexOf(t[a])<0&&Object.prototype.propertyIsEnumerable.call(e,t[a])&&(o[t[a]]=e[t[a]]);return o};const qe=l.forwardRef((e,n)=>{var o,t;const{prefixCls:a,placement:i="top",trigger:f="click",okType:u="primary",icon:d=l.createElement(U,null),children:x,overlayClassName:g,onOpenChange:h,onVisibleChange:v}=e,C=Ye(e,["prefixCls","placement","trigger","okType","icon","children","overlayClassName","onOpenChange","onVisibleChange"]),{getPrefixCls:O}=l.useContext(E),[r,s]=G(!1,{value:(o=e.open)!==null&&o!==void 0?o:e.visible,defaultValue:(t=e.defaultOpen)!==null&&t!==void 0?t:e.defaultVisible}),c=(y,b)=>{s(y,!0),v==null||v(y),h==null||h(y,b)},m=y=>{c(!1,y)},w=y=>{var b;return(b=e.onConfirm)===null||b===void 0?void 0:b.call(void 0,y)},j=y=>{var b;c(!1,y),(b=e.onCancel)===null||b===void 0||b.call(void 0,y)},S=(y,b)=>{const{disabled:z=!1}=e;z||c(y,b)},N=O("popconfirm",a),I=T(N,g),[B]=ee(N);return B(l.createElement(Q,Object.assign({},Be(C,["title"]),{trigger:f,placement:i,onOpenChange:S,open:r,ref:n,overlayClassName:I,content:l.createElement(te,Object.assign({okType:u,icon:d},e,{prefixCls:N,close:m,onConfirm:w,onCancel:j})),"data-popover-inject":!0}),x))}),ne=qe;ne._InternalPanelDoNotUseOrYouWillBeFired=Ue;function Ze({editor:e}){return ge(e),xe(e),he(e),ye(e),ve(e),Ce(e),be(e),Oe(e),Pe(e),we(e,10),p.jsx(je,{editor:e})}const D=Se(A.url,{path:A.path});D.on("connection",e=>{console.log(e.id),e.onmessage("accept",async n=>{console.log("___beidong___accept__"+n)})});function at(){const[e,n]=l.useState([]),[o,t]=l.useState([]),[a,i]=l.useState([]),[f,u]=l.useState({feature:null,skey:-1,info:""}),d=$e(r=>r.jsonReducer.pageback),x=Ee(),g=r=>{try{let s=JSON.parse(r);if(R(s)){let{datasource:c,propKey:m}=ke(s);t(m),n(c),x(Te(r))}else $.error("geojson格式不正确")}catch(s){$.error(s.message)}};function h(r,s){u({skey:r,info:s})}async function v(r){let s=await D.timeout(1200).emitWithAck("call","call").catch(c=>$.error(c));console.log("response:"+s);try{let c=JSON.parse(d.content);if(R(s).result&&R(c).result){let m=null;for(let w of e){for(let j of w.note)if(j.skey===r){m=c.features[r];break}if(m!=null)break}s.features.push(m),D.emit("up",s)}else $.error("主文本格式错误,无法复制")}catch(c){$.error(c)}}const C=[{title:"geometry",dataIndex:"metry",key:"metry",width:100,filters:Ne.flatMap(r=>({text:r,value:r})),onFilter:(r,s)=>s.metry.indexOf(r)===0,filterMultiple:!0,render:r=>p.jsx("div",{className:"h-full px-1",children:p.jsx("p",{children:r})})},{title:"标记",dataIndex:"note",key:"note",render:r=>p.jsx("div",{className:"px-3 flex-col h-full ",children:p.jsxs("p",{className:"bg-cyan-100  px-1.5 py-1 w-fit grow",children:[" count：",r.length]})})}],O=r=>{let s=r.note.flatMap((m,w)=>{let j={key:w,operator:m.skey};return a.map(S=>j[S]=K(m.attr[S])),j}),c=a.flatMap(m=>({title:m,dataIndex:m,key:m}));return a.length>0&&c.push({title:"操作",dataIndex:"operator",key:"operator",width:100,fixed:"right",render:(m,w)=>p.jsx("div",{className:"px-2 py-[1px]",children:p.jsx(ne,{placement:"topRight",title:"确认复制要素",description:`详细信息:${f.info}`,onConfirm:()=>v(f.skey),okText:"Yes",cancelText:"No",children:p.jsx(X,{className:"text-white rounded px-1 bg-blue-500 hover:text-black",onClick:()=>h(m,K(w)),children:"复制到"})})})}),a.length<1&&(s=null),p.jsx(F,{bordered:!1,pagination:!1,showHeader:!0,size:"small",columns:c,dataSource:s})};return p.jsx("div",{className:"p-[1px] min-h-56",children:p.jsxs(W,{className:" shadow-sm border-[1px] shadow-gray-200",children:[p.jsx(W.Panel,{defaultSize:"30%",min:"20%",max:"70%",children:p.jsx(L,{justify:"center",align:"center",style:{height:"100%"},children:p.jsx("div",{className:" focus:border-0 self-stretch w-full overflow-auto  m-1 text-[1rem] ",children:p.jsx(me,{language:"json",value:d.content,wordWrap:!0,insertSpaces:!0,style:{width:"100%"},readOnly:!1,onUpdate:g,children:r=>p.jsx(Ze,{editor:r})})})})}),p.jsx(W.Panel,{max:"70%",children:p.jsx(L,{justify:"center",align:"start",style:{height:"100%"},children:p.jsxs("div",{className:"w-full  min-h-72  ",children:[p.jsx("div",{className:" sticky top-0  z-10",children:p.jsx(fe,{mode:"multiple",allowClear:!0,showSearch:!0,className:"w-1/2 max-w-full my-1  ",placeholder:"属性搜索",optionFilterProp:"label",maxCount:5,filterSort:(r,s)=>((r==null?void 0:r.label)??"").toLowerCase().localeCompare(((s==null?void 0:s.label)??"").toLowerCase()),options:o.flatMap((r,s)=>({value:s,label:r})),onChange:(r,s)=>{i(s.flatMap(c=>c.label))}})}),p.jsx(F,{dataSource:e,pagination:!1,columns:C,size:"small",expandable:{expandedRowRender:O,defaultExpandedRowKeys:["0"],defaultExpandAllRows:!0}})]})})})]})})}export{at as default};
